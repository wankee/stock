<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <title>Highcharts Example</title>
    <script src="/static/js/jquery.min.js"></script>
    <!-- <script src="https://code.highcharts.com/highcharts.js"></script> -->
    <script src="https://code.highcharts.com/stock/highstock.js"></script>
    <script src="https://code.highcharts.com/modules/data.js"></script>
    <!-- <script src="/static/js/papaparse.min.js"></script> -->

    <script>
        $.getJSON(window.location.origin + '/api/fund_history', function (data) {
            // console.log();
            var cash = new Array();
            var date = new Array();
            date[0] = new Date(data[0][0]);
            cash[0]=0;
            console.log(date);
            var now = new Date("2015-04-22");
            console.log(now);
            console.log(now - date[0]);
            var days=(now-date[0])/1000/3600/24;
            console.log(days);
            for (let i = 1; i < days; i++) {
                date[i] = new Date(date[0]);
                date[i].setDate(date[i].getDate() + i);
                cash[i]=i;
                // var m = d.getMonth() + 1;
                // date[i] = new Date().setDate(date[0].getDate() + i);
                // console.log(date[i]);
            }
            console.log(date[10].getDate()-date[0].getDate());
            var x = new Array([], [], []);
            var d2 = new Array();
            // var x = [[],[],[]];
            for (let i = 0; i < data.length; i++) {
                // let row=data[i];
                // console.log(data[i]);
                d2[i] = new Array();
                d2[i][0] = data[i][0];

                // x[0] = new Array();
                x[0][i] = data[i][0];
                x[1][i] = data[i][1];
                if (i == 0) {
                    d2[i][1] = data[i][1];
                    x[2][i] = data[i][1];
                } else {
                    d2[i][1] = d2[i - 1][1] + data[i][1];
                    x[2][i] = data[i][1] + x[2][i - 1];
                }
            }
            console.log(x);
            var t1 = [x[0], x[1]];
            // var t1 =
            //     [
            //         [
            //         "2018-07-08",
            //             65.5
            //         ],
            //         [
            //             1492781400000,
            //             66.4
            //         ],
            //         [
            //             1493040600000,
            //             67.53
            //         ]];

            console.log(t1);
            var t2 = [x[0], x[2]];

            var t2 =
                [
                    [
                        "2018-07-08",
                        165.5
                    ],
                    [
                        1492781400000,
                        166.4
                    ],
                    [
                        1493040600000,
                        67.53
                    ]];

            console.log(data);
            Highcharts.chart('container', {
                // chart: {
                //     type: 'line'
                // },
                // data: {
                //     // enablePolling: true,
                //     csvURL: window.location.origin + '/static/data/fund.csv'
                //     // csv: data
                // },
                // title: {
                //     text: 'Fruit Consumption'
                // },
                // yAxis: {
                //     title: {
                //         text: 'Units'
                //     }
                // }

                rangeSelector: {
                    selected: 4
                },

                yAxis: {
                    labels: {
                        formatter: function () {
                            return (this.value > 0 ? ' + ' : '') + this.value + '%';
                        }
                    },
                    plotLines: [{
                        value: 0,
                        width: 2,
                        color: 'silver'
                    }]
                },

                plotOptions: {
                    series: {
                        compare: 'percent',
                        showInNavigator: true
                    }
                },

                tooltip: {
                    pointFormat: '<span style="color:{series.color}">{series.name}</span>: <b>{point.y}</b> ({point.change}%)<br/>',
                    valueDecimals: 2,
                    split: true
                },
                xAxis: {
                    categories: date,


                    minTickInterval: 24 * 36e5,
                    dateTimeLabelFormats: {
                        day: '%Y-%m-%d'
                    }

                },
                // data:data
                series: [
                    {
                        name: "现金",
                        data: cash
                    }]
            })
            // Highcharts.stockChart('container', {

            //     xAxis: {
            //         categories: x[0]
            //     },

            //     rangeSelector: {
            //         selected: 1
            //     },

            //     title: {
            //         text: 'Fund History'
            //     },
            //     series: [
            //         {
            //             name: '流向',
            //             data: x[1]
            //         }, {
            //             name: '总计',
            //             data: x[2]
            //         }
            //     ]
            // });

            // $(function () {
            // document.addEventListener('DOMContentLoaded', function () {
            /**
             * Use external CSV parser
             * http://papaparse.com/
             */
            // var csv = Papa.parse(document.getElementById('data').innerHTML, {
            //     complete: function (results) {
            //         console.log(results.data);
            //     }
            // });
            // Papa.parse((window.location.origin + "/static/data/fund.csv"), {
            //     download: true,
            //     header: false,
            //     complete: function (results) {
            //         console.log(results);


            // Highcharts.stockChart('container', {

            //     rangeSelector: {
            //         selected: 1
            //     },

            //     title: {
            //         text: 'Fund History'
            //     },

            //     series: [{
            //         name: 'Current Fund',
            //         data: data,
            //         type: 'area',
            //         threshold: null,
            //         tooltip: {
            //             valueDecimals: 2
            //         },
            //         fillColor: {
            //             linearGradient: {
            //                 x1: 0,
            //                 y1: 0,
            //                 x2: 0,
            //                 y2: 1
            //             },
            //             stops: [
            //                 [0, Highcharts.getOptions().colors[0]],
            //                 [1, Highcharts.Color(Highcharts.getOptions().colors[0]).setOpacity(0).get('rgba')]
            //             ]
            //         }
            //     }]
            // });
            // })
            // });



            // $('#container').highcharts({
            //     data: {
            //         rows: data,
            //         seriesMapping: [{
            //             // x: 0, // X values are pulled from column 0 by default
            //             // y: 1, // Y values are pulled from column 1 by default
            //             label: 2 // Labels are pulled from column 2 and picked up in the dataLabels.format below
            //         }]
            //     },
            //     chart: {
            //         type: 'column'
            //     },
            //     title: {
            //         text: '日常运动'
            //     },
            //     xAxis: {
            //         minTickInterval: 24 * 36e5,
            //         dateTimeLabelFormats: {
            //             day: '%Y-%m-%d'
            //         }
            //     },
            //     yAxis: {
            //         title: {
            //             text: '里程数'
            //         },
            //         labels: {
            //             format: '{value} km'
            //         }
            //     },
            //     legend: {
            //         enabled: false
            //     },
            //     plotOptions: {
            //         series: {
            //             dataLabels: {
            //                 enabled: true,
            //                 format: '{point.label}'
            //             },
            //             tooltip: {
            //                 valueSuffix: ' km'
            //             }
            //         }
            //     }
            // });
            // }
            // });

            // Papa.parse(fileInput.files[0], {
            //     complete: function (results) {
            //         console.log(results);
            //     }
            // });

            // document.addEventListener('DOMContentLoaded', function () {





        });
    </script>

</head>

<body>
    <div id="container" style="width: 800px; height: 400px; margin: 0 auto"></div>
    <!-- <div style="max-width: 800px; margin: 0 auto">
        <pre id="data">时间,里程数,标签
        2013-01-01,2.3,
        2013-01-02,3.1,
        2013-01-03,4.8,"最好成绩"
        2013-01-04,1.3</pre>
    </div> -->
</body>

</html>